name: Build and push image to repository
on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Build and tag image
        run: |
          docker build . \
            -t docker.pkg.github.com/bigwigsmods/packager/packager:${GITHUB_SHA::7} \
            -t docker.pkg.github.com/bigwigsmods/packager/packager:latest
      - name: Push image
        run: |
          echo "${{ secrets.DOCKER_PASS }}" | docker login docker.pkg.github.com -u "nebularg" --password-stdin
          docker push docker.pkg.github.com/bigwigsmods/packager/packager:${GITHUB_SHA::7}
          docker push docker.pkg.github.com/bigwigsmods/packager/packager:latest
